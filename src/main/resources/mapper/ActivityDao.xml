<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.dgut.jsf.mapper.ActivityDao">
    <!--查询所有在线的活动  联合查询-->
    <select id="findActivityUp" resultMap="findActivityUpByAct_nameResult">
		select coach_name,coach_sex,coach_expert,coach_resume,act.*
		from t_activity act,t_coach coa
		where act_state=1 and act.coach_id=coa.coach_id
		order by act_time
	</select>
    <!--根据教练名称查询所有在线的活动  一对多
    <select id="findActivityUpByCoach_name" parameterType="String" resultMap="findActivityUpByCoach_nameResult">
         select coach_name,coach_sex,coach_expert,coach_resume,act.*
         from t_activity act,t_coach coa
         where act_state=1 and act.coach_id=coa.coach_id
         and #{condition} like '%#{input}%'
    </select>
    <resultMap id="findActivityUpByCoach_nameResult" type="Coach">
        <id property="coach_id" column="coach_id"></id>
        <result property="coach_name" column="coach_name"></result>
        <result property="coach_sex" column="coach_sex"></result>
        <result property="coach_expert" column="coach_expert"></result>
        <result property="coach_resume" column="coach_resume"></result>
        <collection property="activityList" ofType="Activity">
            <id property="act_id" column="act_id"></id>
            <result property="act_name" column="act_name"></result>
            <result property="act_content" column="act_content"></result>
            <result property="act_date" column="act_date"></result>
        </collection>
    </resultMap>
    -->
    <!--根据活动主题和教练名称查询所有在线的活动  一对一-->
    <select id="findActivityUpByAct_name" resultMap="findActivityUpByAct_nameResult">
         select act.*,coach_name,coach_sex,coach_expert,coach_resume
         from t_activity act,t_coach coa
         where act_state=1 and act.coach_id=coa.coach_id
         and ${arg0} like '%${arg1}%'
         order by act_time
    </select>
<resultMap id="findActivityUpByAct_nameResult" type="Activity">
    <id property="act_id" column="act_id"></id>
    <result property="act_name" column="act_name"></result>
    <result property="act_content" column="act_content"></result>
    <result property="act_time" column="act_time"></result>
    <result property="act_state" column="act_state"></result>
    <association property="coach" javaType="Coach">
                <result property="coach_name" column="coach_name"></result>
                <result property="coach_sex" column="coach_sex"></result>
                <result property="coach_expert" column="coach_expert"></result>
                <result property="coach_resume" column="coach_resume"></result>
            </association>
        </resultMap>
    <!--通过id查询活动  一对一-->
    <select id="findActivityById" parameterType="int"  resultMap="findActivityUpByAct_nameResult">
	select coach_name,coach_sex,coach_expert,coach_resume,act.*
		from t_activity act,t_coach coa
		where act_state=1 and act.coach_id=coa.coach_id
		and act_id=#{act_id}
		order by act_time
	</select>
    <update id="updateActivityState" parameterType="Activity">
		update t_activity set act_state=#{act_state} where act_id = #{act_id }
	</update>
    <select id="findAllCoaName" resultType="Coach">
        select * from t_coach
    </select>
    <select id="findCoachByCoaExpert" parameterType="String" resultType="Coach">
        select * from t_coach
        where coach_expert=#{coach_expert}
    </select>
    <insert id="addActivity" parameterType="Activity">
       insert into t_activity (coach_id, act_name , act_content ,act_time)
        values (#{coach.coach_id},#{act_name},#{act_content},#{act_time});
    </insert>

        </mapper>
