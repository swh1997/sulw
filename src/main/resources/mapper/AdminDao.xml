<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.dgut.jsf.mapper.AdminDao">
<select id="findAllClassHour" resultType="ClassHour">
    select * from t_classhour
</select>
    <delete id="deleteClassHour" parameterType="int">
        delete from t_classhour where ch_id=#{ch_id}
    </delete>
    <update id="updateClassHour" parameterType="ClassHour">
        update t_classhour set ch_type=#{ch_type},ch_content=#{ch_content},ch_price=#{ch_price} where ch_id=#{ch_id}
    </update>
    <insert id="addClassHour" parameterType="ClassHour">
        insert into t_classhour (ch_type,ch_content,ch_price)
        values (#{ch_type},#{ch_content},#{ch_price})
    </insert>
    <select id="findChById" parameterType="int" resultType="ClassHour">
        select * from t_classhour where ch_id=#{ch_id}
    </select>


    <select id="findAllMemberCard" resultType="MemberCard">
    select * from t_membercard
</select>
    <delete id="deleteMemberCard" parameterType="int">
        delete from t_membercard where mc_id=#{mc_id}
    </delete>
    <update id="updateMemberCard" parameterType="MemberCard">
        update t_membercard set mc_quantity=#{mc_quantity},mc_content=#{mc_content},mc_price=#{mc_price} where mc_id=#{mc_id}
    </update>
    <insert id="addMemberCard" parameterType="MemberCard">
        insert into t_membercard (mc_quantity,mc_content,mc_price)
        values (#{mc_quantity},#{mc_content},#{mc_price})
    </insert>
    <select id="findMcById" parameterType="int" resultType="MemberCard">
        select * from t_membercard where mc_id=#{mc_id}
    </select>


    <select id="findAllEqu" resultType="FacilityEquipment">
    select * from t_facilityequipment
</select>
    <delete id="deleteEqu" parameterType="int">
        delete from t_facilityequipment where equ_id=#{equ_id}
    </delete>
    <update id="updateEqu" parameterType="FacilityEquipment">
        update t_facilityequipment set equ_name=#{equ_name},equ_quantity=#{equ_quantity},equ_repairquantity=#{equ_repairquantity},equ_content=#{equ_content} where equ_id=#{equ_id}
    </update>
    <insert id="addEqu" parameterType="FacilityEquipment">
        insert into t_facilityequipment (equ_name,equ_quantity,equ_repairquantity,equ_content)
        values (#{equ_name},#{equ_quantity},#{equ_repairquantity},#{equ_content})
    </insert>
    <select id="findEquById" parameterType="int" resultType="FacilityEquipment">
        select * from t_facilityequipment where equ_id=#{equ_id}
    </select>


    <select id="findAllCoach" resultMap="CoachResult">
    select coa.* ,ch.*
    from t_coach coa,t_classhour ch
    where coa.ch_id=ch.ch_id
</select>
    <resultMap id="CoachResult" type="Coach">
        <id property="coach_id" column="coach_id"></id>
        <result column="coach_name" property="coach_name"  />
        <result column="coach_sex" property="coach_sex" />
        <result column="coach_mobile" property="coach_mobile" />
        <result column="coach_wechat" property="coach_wechat" />
        <result column="coach_qq" property="coach_qq"  />
        <result column="coach_expert" property="coach_expert"  />
        <result column="coach_resume" property="coach_resume" />
        <result column="coach_state" property="coach_state" />
        <association property="classHour" javaType="ClassHour">
            <id property="ch_id" column="ch_id"></id>
            <result column="ch_type" property="ch_type"  />
            <result property="ch_content" column="ch_content"></result>
            <result property="ch_price" column="ch_price"></result>
        </association>
    </resultMap>
    <delete id="deleteCoach" parameterType="int">
        delete from t_coach where coach_id=#{coach_id}
    </delete>
    <update id="updateCoach" parameterType="Coach">
        update t_coach set coach_name=#{coach_name},coach_sex=#{coach_sex},coach_mobile=#{coach_mobile},coach_wechat=#{coach_wechat} ,coach_expert=#{coach_expert},coach_resume=#{coach_resume},ch_id=#{classHour.ch_id}  where coach_id=#{coach_id}
    </update>
    <insert id="addCoach" parameterType="Coach">
        insert into t_coach (coach_name,coach_sex,coach_mobile,coach_wechat,coach_expert,coach_resume,ch_id)
        values (#{coach_name},#{coach_sex},#{coach_mobile},#{coach_wechat},#{coach_expert},#{coach_resume},#{classHour.ch_id})
    </insert>
    <select id="findCoachById" parameterType="int" resultMap="CoachResult">
         select coa.* ,ch.*
    from t_coach coa,t_classhour ch
    where coa.ch_id=ch.ch_id and coach_id=#{coach_id}
    </select>
    <select id="findcAllCh" resultType="ClassHour">
        select * from t_classhour
    </select>
    <select id="findCa" parameterType="Coach" resultType="Boolean">
        select count(ca.ca_id)
        from t_coachappoint ca,t_coach coaa
        where coaa.coach_id=#{arg0} and coaa.coach_id=ca.coach_id and DATEDIFF(ca_startTime,#{arg1})>0
    </select>
<update id=" updateCoachState" parameterType="Coach">
    update t_coach set coach_state=#{coach_state} where coach_id=#{coach_id}
</update>


<select id="findAllMember" resultMap="findAllMemberResult">
      select m.*,ch.*,mc.*
    from  t_membercard mc ,  t_member m LEFT JOIN t_memberclasshour mch on mch.member_id=m.member_id
      LEFT JOIN t_classhour ch on  ch.ch_id=mch.ch_id
where m.mc_id=mc.mc_id
</select>
    <resultMap id="findAllMemberResult" type="Member">
        <id property="member_id" column="member_id"></id>
        <result column="user_id" property="user.user_id" jdbcType="VARCHAR" />
        <result column="member_name" property="member_name" jdbcType="VARCHAR" />
        <result column="member_sex" property="member_sex" jdbcType="VARCHAR" />
        <result column="member_birthDate" property="member_birthDate" jdbcType="VARCHAR" />
        <result column="member_mobile" property="member_mobile" jdbcType="VARCHAR" />
        <result column="member_wechat" property="member_wechat" jdbcType="VARCHAR" />
        <result column="member_qq" property="member_qq" jdbcType="VARCHAR" />
        <result column="member_address" property="member_address" jdbcType="VARCHAR" />
        <result column="member_resume" property="member_resume" jdbcType="VARCHAR" />
        <result column="member_idcard" property="member_idcard" jdbcType="VARCHAR" />
        <result column="mc_id" property="memberCard.mc_id" jdbcType="INTEGER" />
        <result column="member_mcStart" property="member_mcStart" jdbcType="VARCHAR" />
        <result column="member_mcEnd" property="member_mcEnd" jdbcType="VARCHAR" />
        <collection property="classHourList" ofType="ClassHour">
            <id property="ch_id" column="ch_id"></id>
            <result column="ch_type" property="ch_type" jdbcType="VARCHAR" />
            <result property="ch_content" column="ch_content"></result>
            <result property="ch_price" column="ch_price"></result>
        </collection>
        <!--
        <association property="memberCard" javaType="MemberCard">
            <id property="mc_id" column="mc_id"></id>
            <result column="mc_quantity" property="mc_quantity" jdbcType="VARCHAR" />
            <result column="mc_content" property="mc_content" jdbcType="VARCHAR" />
            <result column="mc_price" property="mc_price" jdbcType="VARCHAR" />
        </association>
       -->
    </resultMap>
    <delete id="deleteMember" parameterType="int">
        delete from t_member where member_id=#{member_id}
    </delete>
    <select id="findMemberById" parameterType="int" resultMap="findAllMemberResult">
          select m.*,ch.*,mc.*
    from  t_membercard mc ,  t_member m LEFT JOIN t_memberclasshour mch on mch.member_id=m.member_id
      LEFT JOIN t_classhour ch on  ch.ch_id=mch.ch_id
where m.mc_id=mc.mc_id and m.member_id=#{member_id}
    </select>
    <select id="findMchById" parameterType="MemberClassHour" resultType="MemberClassHour">
        select mch_remainingQuantity,mch_state
        from t_memberclasshour
        where member_id=#{member_id} and ch_id=#{ch_id}
    </select>
    <update id="updateMember" parameterType="Member">
        update t_member set member_name=#{member_name},member_sex=#{member_sex},member_birthDate=#{member_birthDate},member_mobile=#{member_mobile} ,member_wechat=#{member_wechat},member_qq=#{member_qq},member_address=#{member_address},member_resume=#{member_resume},mc_id=#{memberCard.mc_id},member_mcStart=#{member_mcStart},member_mcEnd=#{member_mcEnd}  where member_id=#{member_id}
    </update>


    <update id=" updatePassword" parameterType="User">
        update t_user set   user_pwd=#{user_pwd} where user_id=#{user_id}
    </update>


    <select id="findAllChSm" resultMap="findAllSmResult">
     select sm.*,ch.*
    from t_setmeal sm left join t_setmealclasshour smch on smch.sm_id=sm.sm_id left join t_classhour ch on ch.ch_id=smch.ch_id
    where sm.mc_id=0
</select>
    <select id="findAllSm" resultMap="findAllSmResult">
    select sm.*,mc_content,mc_price,mc_quantity,ch.*
    from t_membercard mc,t_setmeal sm left join t_setmealclasshour smch on smch.sm_id=sm.sm_id left join t_classhour ch on ch.ch_id=smch.ch_id
    where sm.mc_id= if(mc.mc_id>0,mc.mc_id,0)
</select>
    <resultMap id="findAllSmResult" type="SetMeal">
        <id property="sm_id" column="sm_id"></id>
        <result column="sm_name" property="sm_name" jdbcType="VARCHAR" />
        <result column="sm_price" property="sm_price" jdbcType="VARCHAR" />
        <association property="memberCard" javaType="MemberCard">
            <id property="mc_id" column="mc_id"></id>
            <result column="mc_quantity" property="mc_quantity" jdbcType="VARCHAR" />
            <result column="mc_content" property="mc_content" jdbcType="VARCHAR" />
            <result column="mc_price" property="mc_price" jdbcType="VARCHAR" />
        </association>
        <collection property="classHourList" ofType="ClassHour">
            <id property="ch_id" column="ch_id"></id>
            <result column="ch_type" property="ch_type" jdbcType="VARCHAR" />
            <result property="ch_content" column="ch_content"></result>
            <result property="ch_price" column="ch_price"></result>
        </collection>
    </resultMap>
    <delete id="deleteSm" parameterType="int">
        delete from t_setmeal where sm_id=#{sm_id}
    </delete>
    <update id="updateSm" parameterType="SetMeal">
        update t_setmeal set sm_name=#{sm_name},mc_id=#{memberCard.mc_id},sm_price=#{sm_price} where sm_id=#{sm_id}
    </update>
    <insert id="addSm" parameterType="SetMeal">
        insert into t_setmeal (sm_name,mc_id,sm_price)
        values (#{sm_name},#{memberCard.mc_id},#{sm_price})
    </insert>
    <select id="findSmById" parameterType="int" resultType="SetMeal">
        select sm.*,mc_content,mc_price,mc_quantity,ch.*
    from t_membercard mc,t_setmeal sm left join t_setmealclasshour smch on smch.sm_id=sm.sm_id left join t_classhour ch on ch.ch_id=smch.ch_id
    where sm.mc_id=mc.mc_id and sm.sm_id=#{sm_id}
    </select>

</mapper>
