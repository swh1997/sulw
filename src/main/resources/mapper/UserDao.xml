<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="cn.dgut.jsf.mapper.UserDao">
	<!--通过会员账号密码登录验证-->
	<select id="loginCheck" parameterType="User" resultType="User">
		select * from t_user where user_id=#{user_id} and user_pwd=#{user_pwd}
	</select>
    <!--根据会员id查找该会员拥有的上线的课时类型  多对多 -->
    <select id="findClassHourUpByUserId" parameterType="String" resultMap="findClassHourUpByUserIdResult">
            select m.*,ch.ch_id,ch_content,ch_price,mch_id,mch_remainingQuantity
            from t_member m,t_classhour ch,t_memberclasshour mch
            where mch_state=1 and mch.member_id=m.member_id and mch.ch_id=ch.ch_id
            and m.user_id=#{user_id}
       </select>
    <select id="findChByMemberId" parameterType="INTEGER"  resultType="INTEGER">
        select count(mch_id) from t_memberclasshour where member_id=#{member_id}
    </select>
    <resultMap id="findClassHourUpByUserIdResult" type="Member">
        <id property="member_id" column="member_id"></id>
        <result column="user_id" property="user.user_id" jdbcType="VARCHAR" />
        <result column="member_name" property="member_name" jdbcType="VARCHAR" />
        <result column="member_sex" property="member_sex" jdbcType="VARCHAR" />
        <result column="member_birthDate" property="member_birthDate" jdbcType="VARCHAR" />
        <result column="member_mobile" property="member_mobile" jdbcType="VARCHAR" />
        <result column="member_wechat" property="member_wechat" jdbcType="VARCHAR" />
        <result column="member_qq" property="member_qq" jdbcType="VARCHAR" />
        <result column="member_address" property="member_address" jdbcType="VARCHAR" />
        <result column="member_resume" property="member_resume" jdbcType="VARCHAR" />
        <result column="member_idcard" property="member_idcard" jdbcType="VARCHAR" />
        <result column="mc_id" property="memberCard.mc_id" jdbcType="INTEGER" />
        <result column="member_mcStart" property="member_mcStart" jdbcType="VARCHAR" />
        <result column="member_mcEnd" property="member_mcEnd" jdbcType="VARCHAR" />
        <collection property="classHourList" ofType="ClassHour">
            <id property="ch_id" column="ch_id"></id>
            <result column="ch_type" property="ch_type" jdbcType="VARCHAR" />
            <result property="ch_content" column="ch_content"></result>
            <result property="ch_price" column="ch_price"></result>
        </collection>
    </resultMap>
    <!--通过会员账号找会员信息-->
    <select id="findMNameByUserId" parameterType="String" resultMap="findMNameByUserIdResult">
		select * from t_member where user_id=#{user_id}
	</select>
    <resultMap id="findMNameByUserIdResult" type="Member">
        <id property="member_id" column="member_id"></id>
        <result column="user_id" property="user.user_id" jdbcType="VARCHAR" />
        <result column="member_name" property="member_name" jdbcType="VARCHAR" />
        <result column="member_sex" property="member_sex" jdbcType="VARCHAR" />
        <result column="member_birthDate" property="member_birthDate" jdbcType="VARCHAR" />
        <result column="member_mobile" property="member_mobile" jdbcType="VARCHAR" />
        <result column="member_wechat" property="member_wechat" jdbcType="VARCHAR" />
        <result column="member_qq" property="member_qq" jdbcType="VARCHAR" />
        <result column="member_address" property="member_address" jdbcType="VARCHAR" />
        <result column="member_resume" property="member_resume" jdbcType="VARCHAR" />
        <result column="member_idcard" property="member_idcard" jdbcType="VARCHAR" />
        <result column="mc_id" property="memberCard.mc_id" jdbcType="INTEGER" />
        <result column="member_mcStart" property="member_mcStart" jdbcType="VARCHAR" />
        <result column="member_mcEnd" property="member_mcEnd" jdbcType="VARCHAR" />
    </resultMap>
	<!--通过管理员账号找管理员信息-->
	<select id="findANameByUserId" parameterType="String" resultType="Admin">
		select * from t_admin where user_id=#{user_id}
	</select>
<update id="updatePassword">
   update t_user set user_pwd=#{user_pwd}
		where user_id=#{user_id}
</update>
    <select id="findAllUserMember" resultMap="findAllUserResult">
		select u.* ,m.member_name,m.mc_id,f.fee_id,f.fee_used,f.fee_datetimet
		from t_member m,t_user u LEFT JOIN t_fee f on f.user_id=u.user_id
		 where user_type='1' and u.user_id=m.user_id
	</select>

    <select id="findAllUserAdmin" resultMap="findAllUserResult">
		select u.* ,a.admin_name,f.fee_id,f.fee_used,f.fee_datetimet
		 from t_admin a,t_user u LEFT JOIN t_fee f on f.user_id=u.user_id
		 where user_type!='1' and u.user_id=a.user_id
	</select>
    <resultMap id="findAllUserResult" type="User">
        <id column="user_id" property="user_id"></id>
        <result column="user_pwd" property="user_pwd"></result>
        <result column="user_type" property="user_type"></result>
        <result column="user_state" property="user_state"></result>
        <association property="member" javaType="Member">
            <result column="member_name" property="member_name"></result>
            <result column="mc_id" property="memberCard.mc_id"></result>
        </association>
        <association property="admin" javaType="Admin">
            <result column="admin_name" property="admin_name"></result>
        </association>
        <collection property="feeList" ofType="Fee">
            <id column="fee_id" property="fee_id"></id>
            <result column="fee_used" property="fee_used"></result>
            <result column="fee_datetimet" property="fee_datetimet"></result>
        </collection>
    </resultMap>
    <select id="findUserById" parameterType="String" resultType="User">
		select * from t_user where user_id=#{user_id}
	</select>
<update id="updateState" parameterType="User">
    update t_user set user_state=#{user_state} where user_id=#{user_id}
</update>
    <select id="findFeeById" parameterType="String" resultMap="findFeeByIdResult">
        select f.*
        from t_fee f
        where user_id=#{row}
    </select>
    <resultMap id="findFeeByIdResult" type="Fee">
        <id column="fee_id" property="fee_id"></id>
        <result column="fee_used" property="fee_used"></result>
        <result column="fee_datetimet" property="fee_datetimet"></result>
       <result property="setMeal.sm_id" column="sm_id"></result>
    </resultMap>
    <select id="findSmById" parameterType="int" resultMap="findSmByIdResult">
        select *
        from t_setmeal
        where sm_id=#{sm_id}
    </select>
    <resultMap id="findSmByIdResult" type="setMeal">
        <id property="sm_id" column="sm_id"></id>
        <result property="sm_name" column="sm_name"></result>
        <result property="sm_price" column="sm_price"></result>
        <result property="memberCard.mc_id" column="mc_id"></result>
    </resultMap>
    <select id="findMcById" parameterType="int" resultType="MemberCard">
        select *
        from t_membercard
        where mc_id=#{mc_id}
    </select>
    <select id="findChById" parameterType="int" resultType="ClassHour">
        select *
        from t_classhour
        where ch_id=#{ch_id}
    </select>
    <select id="findMchById" parameterType="int" resultType="MemberClassHour">
        select *
        from t_memberclasshour
        where member_id=#{member_id}
    </select>

</mapper>
