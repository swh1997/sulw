<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<html>
<head>
<meta charset="utf-8">
<meta name="renderer" content="webkit|ie-comp|ie-stand">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
	<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
<!--[if lt IE 9]-->
<script type="text/javascript" src="/lib/html5shiv.js"></script>
<script type="text/javascript" src="/lib/respond.min.js"></script>
<!--[endif]-->
<link rel="stylesheet" type="text/css" href="/h-ui/css/H-ui.min.css" />
<link rel="stylesheet" type="text/css" href="/h-ui.admin/css/H-ui.admin.css" />
<link rel="stylesheet" type="text/css" href="/lib/Hui-iconfont/1.0.8/iconfont.css" />
<link rel="stylesheet" type="text/css" href="/h-ui.admin/skin/default/skin.css" id="skin" />
<link rel="stylesheet" type="text/css" href="/h-ui.admin/css/style.css" />
<!--[if IE 6]-->
<script type="text/javascript" src="/lib/DD_belatedPNG_0.0.8a-min.js" ></script>
    <script>DD_belatedPNG.fix('*');</script>
<!--[endif]-->
<title>城院北门健身俱乐部管理系统--会员快速注册</title>
    <script src="/js/jquery-1.8.3.min.js"></script>
</head>
<body>
<article class="page-container">
    <a th:href="@{/}" title="返回" ><i class="Hui-iconfont">&#xe66b;</i></a>
<h1 align="center"><img alt="" th:src="@{/img/register.png}"></h1>
	<h6 align="center"><font color="red">温馨提示：带 * 的选项为必填选项，一旦提交，将无法修改！请谨慎填写！！</font></h6>
	<form class="form form-horizontal" id="form-member-add">

	<div class="row cl">
		<label class="form-label col-xs-4 col-sm-5"><span class="c-red">*</span>账号：</label>
		<div class="formControls col-xs-4"> 
			<input style="width: 150px;" type="text" class="input-text" value="" placeholder="请输入账号" id="user_id" name="user_id" onkeyup="this.value=this.value.replace(/[^\w_]/g);">
		</div>
	</div>

	<div class="row cl">
		<label class="form-label col-xs-4 col-sm-5"><span class="c-red">*</span>初始密码：</label>
		<div class="formControls col-xs-4">
			<input style="width: 170px;" type="password" class="input-text" autocomplete="off" value="" placeholder="长度在6-15位之间" id="password" name="password">
		</div>
	</div>

	<div class="row cl">
		<label class="form-label col-xs-4 col-sm-5"><span class="c-red">*</span>确认密码：</label>
		<div class="formControls col-xs-4">
			<input style="width: 170px;" type="password" class="input-text" autocomplete="off" value="" placeholder="重复输入密码" id="user_pwd" name="user_pwd">
        </div>
	</div>

	<div class="row cl">
		<label class="form-label col-xs-4 col-sm-5"><span class="c-red">*</span>姓名：</label>
		<div class="formControls col-xs-4">
			<input style="width: 150px;" type="text" class="input-text" id="member_name" name="member_name">
		</div>
	</div>

		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-5"><span class="c-red">*</span>身份证：</label>
			<div class="formControls col-xs-4">
				<input style="width: 200px;" type="text" class="input-text"  name="member_idcard" id="member_idcard" onblur="validateDidentity()">
			</div>
		</div>

	<div class="row cl">
		<label class="form-label col-xs-4 col-sm-5"><span class="c-red">*</span>性别：</label>
			<div class="formControls skin-minimal col-xs-3" style="width: 100px;">
			<span class="select-box">
						<select class="select" size="1" name="member_sex" id="member_sex">
									<option value="男" selected>男</option>
									<option value="女">女</option>
						</select>
			</span>
		</div>
	</div>

		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-5"><span class="c-red">*</span>出生日期：</label>
			<div class="formControls col-xs-4">
				<input type="date" style="width: 200px;" class="input-text" value="1997-04-24"  name="member_birthDate" id="member_birthDate" >
			</div>
		</div>

		<div class="row cl">
			<label class="form-label col-xs-4 col-sm-5">手机号码：</label>
			<div class="formControls col-xs-4">
				<input type="text" style="width: 200px;" class="input-text" placeholder="请输入手机号码" value="" name="member_mobile" id="member_mobile" >
			</div>
		</div>

        <div class="row cl">
            <label class="form-label col-xs-4 col-sm-5">住址：</label>
            <div class="formControls col-xs-4">
				<textarea cols="4" rows="15"  style="width: 200px;" class="input-text" placeholder="请输入住址" value="" name="member_address" id="member_address" ></textarea>
            </div>
        </div>

	<div class="row cl">
	<label class="form-label col-xs-4 col-sm-5"></label>
		<div class="formControls col-xs-3">
			<input class="btn btn-primary radius" type="submit" value="&nbsp;&nbsp;提交&nbsp;&nbsp;">
		</div>
	</div>

	</form>
</article>
<!--_footer 作为公共模版分离出去--> 
<script type="text/javascript" src="/lib/jquery/1.9.1/jquery.js"></script>
<script type="text/javascript" src="/lib/layer/2.4/layer.js"></script>
<script type="text/javascript" src="/h-ui/js/H-ui.min.js"></script>
<script type="text/javascript" src="/h-ui.admin/js/H-ui.admin.js"></script> <!--/_footer 作为公共模版分离出去-->
<!--请在下方写此页面业务相关的脚本-->
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/jquery.validate.js"></script>
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/validate-methods.js"></script>
<script type="text/javascript" src="/lib/jquery.validation/1.14.0/messages_zh.js"></script>
<script >
    $(document).ready(function(){
        $("#password").text(" ");


    });
</script>
<script type="text/javascript">
	$(function() {
		$('.skin-minimal input').iCheck({
			checkboxClass : 'icheckbox-blue',
			radioClass : 'iradio-blue',
			increaseArea : '20%'
		});
    //会员注册
		$("#form-member-add").validate({
							rules : {
								user_id : {
									required : true,
									minlength : 8,
									maxlength : 15
								},
								user_pwd : {
									required : true,
									minlength : 6,
									maxlength : 15
								},
								password : {
									required : true,
									equalTo : "#user_pwd"
								},
								member_name : {
									isChinese : true,
									required : true,
									maxlength : 8
								},
								member_idcard : {
									required : true,
								},
								member_sex : {
									required : true,
								},
								member_mobile : {
									required : true,
									isDigits : true,
									minlength : 11,
									maxlength : 11
								},
								member_address : {
									isChinese : true,
									required : true,
									minlength : 4,
									maxlength : 50
								},
							},
							messages : {
								user_id : {
									minlength : "请输入8~15位账号！",
									maxlength : "请输入8~15位账号！",
								},
								password : {
									equalTo : "两次输入的密码不一致！",
								},
								member_name : {
									isChinese : "只能输入中文",
									maxlength : "最多只能输入8位中文",
								},
								member_sex : {
									required : "请选择您的性别！",
								},
								member_mobile : {
									minlength : "请输入11位号码！",
									maxlength : "请输入11位号码！",
								},
								member_address: {
									isChinese : "只能输入中文",
									minlength : "至少输入4位中文,格式如：广东东莞",
									maxlength : "最多输入50位中文",
								},
							},
							onkeyup : false,
							focusCleanup : true,
							success : "valid",
							submitHandler : function(form) {
								$(form).ajaxSubmit({
													type : "post",
													url : "/member/addMember",
													dataType : "text",
													async : false,
													success : function(data) {
														if (data >= "2") {
															layer.confirm('会员账户注册成功！请重新登录系统', {
																  btn: ['确定']
																},  function(){
																	window.location.href ='/';
																});
														} else if (data == "1") {
															layer.alert("你输入的身份证已经被注册过了，请联系系统管理员了解情况！");//addmember时唯一键
														} else if (data == "0") {
															layer.alert("注册失败！您输入的会员卡号已存在！忘记密码联系系统管理员找回");//adduser时主键
														}
													},
													error : function(
															XmlHttpRequest,
															textStatus,
															errorThrown) {
														layer.alert("失败了好多回了吧~哈哈哈哈！");
													}
												});
							}
						});

	});
	//为值添加0  
	function Append_zore(temp) {
		if (temp < 10)
			return "0" + temp;
		else
			return temp;
	}
	//身份证号码验证     
	function validateDidentity() {
		var certNumber = document.getElementById("member_idcard").value;
		if (certNumber != "") {
			//身份证的地区代码对照  
			var aCity = {
				11 : "北京",
				12 : "天津",
				13 : "河北",
				14 : "山西",
				15 : "内蒙古",
				21 : "辽宁",
				22 : "吉林",
				23 : "黑龙江",
				31 : "上海",
				32 : "江苏",
				33 : "浙江",
				34 : "安徽",
				35 : "福建",
				36 : "江西",
				37 : "山东",
				41 : "河南",
				42 : "湖北",
				43 : "湖南",
				44 : "广东",
				45 : "广西",
				46 : "海南",
				50 : "重庆",
				51 : "四川",
				52 : "贵州",
				53 : "云南",
				54 : "西藏",
				61 : "陕西",
				62 : "甘肃",
				63 : "青海",
				64 : "宁夏",
				65 : "新疆",
				71 : "台湾",
				81 : "香港",
				82 : "澳门",
				91 : "国外"
			};
			//获取证件号码  
			var person_id = certNumber;
			//合法性验证  
			var sum = 0;
			//出生日期  
			var birthday;
			//验证长度与格式规范性的正则  
			var pattern = new RegExp(/(^\d{15}$)|(^\d{17}(\d|x|X)$)/i);
			if (pattern.exec(person_id)) {
				//验证身份证的合法性的正则  
				pattern = new RegExp(
						/^[1-9]\d{7}((0\d)|(1[0-2]))(([0|1|2]\d)|3[0-1])\d{3}$/);
				if (pattern.exec(person_id)) {
					//获取15位证件号中的出生日期并转位正常日期       
					birthday = "19" + person_id.substring(6, 8) + "-"
							+ person_id.substring(8, 10) + "-"
							+ person_id.substring(10, 12);
				} else {
					person_id = person_id.replace(/x|X$/i, "a");
					//获取18位证件号中的出生日期  
					birthday = person_id.substring(6, 10) + "-"
							+ person_id.substring(10, 12) + "-"
							+ person_id.substring(12, 14);

					//校验18位身份证号码的合法性  
					for (var i = 17; i >= 0; i--) {
						sum += (Math.pow(2, i) % 11)
								* parseInt(person_id.charAt(17 - i), 11);
					}
					if (sum % 11 != 1) {
						$(this).addClass("txtRequired");
						layer.alert("身份证号码不符合国定标准，请核对！");
						$("#member_idcard").val("");
						return;
					}else{
                        var param = {};
                        param["idcard"] =certNumber.toString();
                        //var json=JSON.stringify(param);
						$.ajax({
							url : "/welcome/findNaticePlace",
							type : "post",
                           // contentType : "application/json;charset=UTF-8",
                            data:param,
							dataType : "text",
							success: function(data){
								$("#member_address").val(data);
								layer.alert("身份证符合国际标准");
							},
							error : function(data) {
								layer.alert("一般不会出现");
							}
						}); 
					}
				}
				//检测证件地区的合法性                                  
				if (aCity[parseInt(person_id.substring(0, 2))] == null) {
					$(this).addClass("txtRequired");
					layer.alert("身份证地区未知，请核对！");
					$("#member_idcard").val("");
					return;
				}
				var dateStr = new Date(birthday.replace(/-/g, "/"));
				if (birthday != (dateStr.getFullYear() + "-"
						+ Append_zore(dateStr.getMonth() + 1) + "-" + Append_zore(dateStr
						.getDate()))) {
					$(this).addClass("txtRequired");
					layer.alert('身份证出生日期非法！');
					$("#member_idcard").val("");
					return;
				}
				$(this).removeClass("txtRequired");
				//修改证件号码
				$("#member_birthDate").val(birthday);
				//带出性别
				var last = certNumber[certNumber.length - 2];
				if (last % 2 != 0)
					$("#member_sex option[value='男']").prop("selected","selected");
				else
					$("#member_sex option[value='女']").prop("selected","selected");
			} else {
				$(this).addClass("txtRequired");
				layer.alert('身份证号码格式非法！');
				$("#member_idcard").val("");
				return;
			}
		}
	}
</script> 
<!--/请在上方写此页面业务相关的脚本-->
</body>
</html>